<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–Ω–∞–ª–∏–∑ –∑–∞–∫–∞–∑–æ–≤ - BBus</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
    }

    .container {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header img {
      height: 60px;
      margin-bottom: 10px;
    }

    .header h1 {
      font-size: 28px;
      color: #800000;
      font-weight: 700;
    }

    .nav-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .nav-links a {
      background-color: #800000;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    .nav-links a:hover {
      background-color: #a00000;
    }

    .section-title {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
      border-left: 5px solid #800000;
      padding-left: 10px;
      font-weight: 600;
    }

    .chart-container {
      margin-bottom: 30px;
      padding: 20px;
      background-color: #fafafa;
      border-radius: 6px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }

    .chart-container h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }

    .chart-description {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="bbus_logo.png" alt="BBus Logo">
      <h1>–ê–Ω–∞–ª–∏–∑ –∑–∞–∫–∞–∑–æ–≤</h1>
    </div>

    <div class="nav-links">
      <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="orders_table.html">üìã –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏</a>
    </div>

    <div class="section-title">–ê–Ω–∞–ª–∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</div>
    <div class="row">
      <div class="col-md-6">
        <div class="chart-container">
          <h3>–¢–æ–ø-10 —Ç–∏–ø–æ–≤ –¢–°</h3>
          <div id="topVehiclesChart"></div>
          <div class="chart-description">
            –ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="chart-container">
          <h3>–¢–æ–ø-10 –∑–∞–∫–∞–∑—á–∏–∫–æ–≤</h3>
          <div id="topCustomersChart"></div>
          <div class="chart-description">
            –°–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–∫–∞–∑–æ–≤.
          </div>
        </div>
      </div>
    </div>

    <div class="section-title">–í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑</div>
    <div class="row">
      <div class="col-md-12">
        <div class="chart-container">
          <h3>–î–∏–Ω–∞–º–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
          <div id="monthlyOrdersChart"></div>
          <div class="chart-description">
            –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Å–ø—Ä–æ—Å–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —É—Å–ª—É–≥–∏.
          </div>
        </div>
      </div>
      <div class="col-md-12">
        <div class="chart-container">
          <h3>–ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã –∑–∞–∫–∞–∑–æ–≤</h3>
          <div id="hourlyOrdersChart"></div>
          <div class="chart-description">
            –ß–∞—Å—ã –Ω–∞–∏–±–æ–ª—å—à–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.
          </div>
        </div>
      </div>
    </div>

    <div class="section-title">–ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
    <div class="row">
      <div class="col-md-6">
        <div class="chart-container">
          <h3>–ü–∞—Å—Å–∞–∂–∏—Ä—ã vs –¶–µ–Ω–∞</h3>
          <div id="pricePassengersChart"></div>
          <div class="chart-description">
            –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ü–µ–Ω—ã –æ—Ç —á–∏—Å–ª–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤.
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="chart-container">
          <h3>–ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º</h3>
          <div id="customerFrequencyChart"></div>
          <div class="chart-description">
            –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function loadData() {
      try {
        const response = await fetch('https://bbus-project.onrender.com/api/analysis_data');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        return null;
      }
    }

    function createCharts(data) {
      Plotly.newPlot('topVehiclesChart', [{
        x: data.topVehicles.map(i => i.type),
        y: data.topVehicles.map(i => i.count),
        type: 'bar',
        marker: { color: '#800000' }
      }], {
        title: '–¢–æ–ø-10 —Ç–∏–ø–æ–≤ –¢–°',
        xaxis: { title: '–¢–∏–ø –¢–°', tickangle: -45 },
        yaxis: { title: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤' }
      });

      Plotly.newPlot('topCustomersChart', [{
        x: data.topCustomers.map(i => i.customer),
        y: data.topCustomers.map(i => i.count),
        type: 'bar',
        marker: { color: '#004080' }
      }], {
        title: '–¢–æ–ø-10 –∑–∞–∫–∞–∑—á–∏–∫–æ–≤',
        xaxis: { title: '–ó–∞–∫–∞–∑—á–∏–∫', tickangle: -45 },
        yaxis: { title: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤' }
      });

      Plotly.newPlot('monthlyOrdersChart', [{
        x: data.monthlyOrders.map(i => i.month),
        y: data.monthlyOrders.map(i => i.count),
        type: 'scatter',
        mode: 'lines+markers',
        marker: { size: 6, color: '#339966' },
        line: { width: 2 }
      }], {
        title: '–ü–æ –º–µ—Å—è—Ü–∞–º',
        xaxis: { title: '–ú–µ—Å—è—Ü' },
        yaxis: { title: '–ó–∞–∫–∞–∑—ã' }
      });

      Plotly.newPlot('hourlyOrdersChart', [{
        x: data.hourlyOrders.map(i => i.hour),
        y: data.hourlyOrders.map(i => i.count),
        type: 'bar',
        marker: { color: '#ffaa00' }
      }], {
        title: '–ü–æ —á–∞—Å–∞–º',
        xaxis: { title: '–ß–∞—Å', tickmode: 'linear' },
        yaxis: { title: '–ó–∞–∫–∞–∑—ã' }
      });

      Plotly.newPlot('pricePassengersChart', [{
        x: data.pricePassengers.map(i => i.–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤),
        y: data.pricePassengers.map(i => i.–¶–µ–Ω–∞–ó–∞–ß–∞—Å),
        mode: 'markers',
        type: 'scatter',
        marker: { size: 7, color: '#800080', opacity: 0.6 }
      }], {
        title: '–ü–∞—Å—Å–∞–∂–∏—Ä—ã –∏ —Ü–µ–Ω–∞',
        xaxis: { title: '–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤' },
        yaxis: { title: '–¶–µ–Ω–∞' }
      });

      Plotly.newPlot('customerFrequencyChart', [{
        x: data.customerFrequency.map(i => i.customer),
        y: data.customerFrequency.map(i => i.order_count),
        type: 'bar',
        marker: { color: '#006666' }
      }], {
        title: '–ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–∫–∞–∑–æ–≤',
        xaxis: { title: '–ó–∞–∫–∞–∑—á–∏–∫', tickangle: -45 },
        yaxis: { title: '–ö–æ–ª-–≤–æ' }
      });
    }

    window.onload = async function() {
      const data = await loadData();
      if (data) createCharts(data);
    };
  </script>
</body>
</html>
